<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>報單管理</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!--固定在頁面頂部-->
    <div class="tabs-wrapper">
        <div class="tabs">
            <div class="tab-links active" onclick="openTab('header')">出口報單表頭</div>
            <div class="tab-links" onclick="openTab('items')">出口報單項次</div>
            <div class="tab-links" onclick="openTab('copy')">申請報單副本</div>
            <div class="tab-links" onclick="openTab('bonded')">保稅相關信息</div>
            <!-- 新增影片鏈接部分 -->
            <div class="video-link" style="margin-top: 10px;">
                <select id="videoSelector" onchange="updateVideoLink()">
                    <option value="Interface_Operation.mp4">介面操作</option>
                    <option value="LEE_BOU_CNDGG.mp4">利保東莞</option>
                    <option value="LEE_BOU_VNLAN.mp4">利保隆安</option>
                </select>
                <a id="videoLink" href="Interface_Operation.mp4" target="_blank">【影片說明】</a>
            </div>
        </div>
    </div>

    <p id="dynamicMargin" style="margin-top: 0;"></p>

    <div class="scroll-container">
        <!-- 回到頂部按鈕 -->
        <button class="scroll-btn" onclick="scrollToTop()" title="回到頂部">▲</button>
        <!-- 移到最下方按鈕 -->
        <button class="scroll-btn" onclick="scrollToBottom()" title="移到最下方">▼</button>
    </div>
    
    <!--報單表頭-->    
    <div id="header" class="tab active">
        <div class="header-section">
            <div class="header-group">
                <label for="FILE_NO">文件編號</label>
                <input type="text" id="FILE_NO" name="FILE_NO">
            </div>
            <div class="header-group">
                <label for="LOT_NO">運單號</label>
                <input type="text" id="LOT_NO" name="LOT_NO">
            </div>
            <hr>
            <div class="header-group">
                <label for="SHPR_BAN_ID">出口人統一編號</label>
                <input type="text" id="SHPR_BAN_ID" name="SHPR_BAN_ID"
                placeholder="輸入統一編號以查找資料" onkeydown="preventArrowKeyAdjustment(event)">
                <button type="button" onclick="searchData()">搜尋</button>
            </div>
            <div class="header-group">
                <label for="SHPR_BONDED_ID">海關監管編號</label>
                <input type="text" id="SHPR_BONDED_ID" name="SHPR_BONDED_ID"
                placeholder="(非保稅此欄免填)">
            </div>
            <div class="header-group">
                <label for="SHPR_C_NAME">出口人中文名稱</label>
                <input type="text" id="SHPR_C_NAME" name="SHPR_C_NAME">
            </div>
            <div class="header-group">
                <label for="SHPR_E_NAME">出口人英文名稱</label>
                <input type="text" id="SHPR_E_NAME" name="SHPR_E_NAME">
            </div>
            <div class="header-group">
                <label for="SHPR_C_ADDR">出口人中文地址</label>
                <input type="text" id="SHPR_C_ADDR" name="SHPR_C_ADDR">
            </div>
            <div class="header-group">
                <label for="SHPR_E_ADDR">出口人英文地址</label>
                <input type="text" id="SHPR_E_ADDR" name="SHPR_E_ADDR">
            </div>
            <hr>
            <div class="header-group">
                <label for="CNEE_E_NAME">買方中/英名稱</label>
                <input type="text" id="CNEE_E_NAME" name="CNEE_E_NAME">
            </div>
            <div class="header-group">
                <label for="CNEE_E_ADDR">買方中/英地址</label>
                <input type="text" id="CNEE_E_ADDR" name="CNEE_E_ADDR">
            </div>
            <div class="header-group">
                <label for="CNEE_COUNTRY_CODE">買方國家代碼</label>
                <input type="text" id="CNEE_COUNTRY_CODE" name="CNEE_COUNTRY_CODE"
                placeholder="範例：HK、CN、KR、SG(英文代碼)">
            </div>
            <div class="header-group">
                <label for="CNEE_BAN_ID">買方統一編號</label>
                <input type="text" id="CNEE_BAN_ID" name="CNEE_BAN_ID"
                placeholder="(非台灣營業公司此欄免填)" onkeydown="preventArrowKeyAdjustment(event)">
            </div>            
            <hr>
            <div class="header-group">
                <label for="BUYER_E_NAME">收方名稱</label>
                <input type="text" id="BUYER_E_NAME" name="BUYER_E_NAME"
                placeholder="(買方為台灣營業公司需填列)">
            </div>
            <div class="header-group">
                <label for="BUYER_E_ADDR">收方地址</label>
                <input type="text" id="BUYER_E_ADDR" name="BUYER_E_ADDR"
                placeholder="(買方為台灣營業公司需填列)">
            </div>
            <div class="header-group">
                <label for="TO_CODE">目的地(代碼)</label>
                <input type="text" id="TO_CODE" name="TO_CODE"
                placeholder="範例：HKHKG、CNSZX、KRICN、SGSIN(英文代碼)">
            </div>
            <div class="header-group">
                <label for="TO_DESC">目的地(名稱)</label>
                <input type="text" id="TO_DESC" name="TO_DESC"
                placeholder="(英文名稱)">
            </div>
        </div>
        <hr>

        <div class="header-section">
            <div class="header-group">
                <label for="TOT_CTN">總件數</label>
                <input type="number" id="TOT_CTN" name="TOT_CTN" min="1" step="1" onkeydown="preventArrowKeyAdjustment(event)">
            </div>
            <div class="header-group">
                <label for="DOC_CTN_UM">總件數單位</label>
                <input type="text" id="DOC_CTN_UM" name="DOC_CTN_UM"
                placeholder="範例：CTN、PKG、BOX、PLT(英文代碼)">
            </div>
            <div class="header-group">
                <label for="CTN_DESC">包裝說明</label>
                <input type="text" id="CTN_DESC" name="CTN_DESC"
                placeholder="(一般倉或ECFA包裝說明)">
            </div>
            <div class="header-group">
                <label for="DCL_GW">總毛重</label>
                <input type="number" id="DCL_GW" name="DCL_GW" onkeydown="preventArrowKeyAdjustment(event)">
            </div>
            <div class="header-group">
                <label for="DCL_NW">總淨重</label>
                <input type="number" id="DCL_NW" name="DCL_NW" onkeydown="preventArrowKeyAdjustment(event)">
            </div>
        </div>
        <hr>

        <div class="header-section">
            <div class="header-group">
                <label for="DCL_DOC_TYPE">報單類別</label>
                <input type="text" id="DCL_DOC_TYPE" name="DCL_DOC_TYPE" list="member"
                placeholder="(下拉式選單)">
                <datalist id="member">
                    <option value="G5">國貨出口</option>
                    <option value="G3">外貨復出口</option>
                    <option value="B8">保稅廠進口貨物(原料)復出口</option>
                    <option value="B9">保稅廠產品出口</option>
                    <option value="D5">保稅倉貨物出口</option>
                    <option value="F5">自由港區貨物出口</option>
                </datalist>            
            </div>
            <div class="header-group">
                <label for="TERMS_SALES">貿易條件</label>
                <input type="text" id="TERMS_SALES" name="TERMS_SALES" list="terms"
                placeholder="(下拉式選單)">
                <datalist id="terms">
                    <option value="EXW">需填列應加費用，不得填列運保費</option>
                    <option value="FOB">不含運費、保險費</option>
                    <option value="CFR">含運費</option>
                    <option value="C&I">含保險費</option>
                    <option value="CIF">含運費、保險費</option>
                </datalist>              
            </div>
            <div class="header-group">
                <label for="CURRENCY">幣別</label>
                <input type="text" id="CURRENCY" name="CURRENCY"
                placeholder="範例：TWD、USD、CNY、JPY、EUR(英文代碼)">
                <span id="currency-error" style="color: rgba(255, 0, 0, 0.634); display: none; margin-left: 4px; margin-top: 4px;">幣別錯誤，請重新輸入</span>
            </div>
            <div class="header-group">
                <label for="CAL_IP_TOT_ITEM_AMT">總金額</label>
                <input type="number" id="CAL_IP_TOT_ITEM_AMT" name="CAL_IP_TOT_ITEM_AMT"
                placeholder="(若為台幣總金額不可有小數點、EXW 總金額不含應加費用)" onkeydown="preventArrowKeyAdjustment(event)">
            </div>
            <hr>
            <div class="header-group">
                <label for="FRT_AMT">運費</label>
                <input type="number" id="FRT_AMT" name="FRT_AMT"
                placeholder="(CFR、CIF 需填列運費，EXW 不得填列運費)" onkeydown="preventArrowKeyAdjustment(event)">
                <button id="calculate-freight-button">計算運費</button>
            </div>   
            <div class="header-group">
                <label for="INS_AMT">保險費</label>
                <input type="number" id="INS_AMT" name="INS_AMT"
                placeholder="(C&I、CIF 需填列保險費，EXW 不得填列保險費)" onkeydown="preventArrowKeyAdjustment(event)">
                <button id="calculate-insurance-button">計算保險費</button>
            </div>
            <div class="header-group">
                <label for="ADD_AMT">應加費用</label>
                <input type="number" id="ADD_AMT" name="ADD_AMT"
                placeholder="(EXW 需填列應加費用)" onkeydown="preventArrowKeyAdjustment(event)">
                <button id="calculate-additional-button">計算應加費用(TWD500)</button>
            </div>
            <div class="header-group">
                <label for="SUBTRACT_AMT">應減費用</label>
                <input type="number" id="SUBTRACT_AMT" name="SUBTRACT_AMT" 
                placeholder="(EXW 不得填列應減費用)" onkeydown="preventArrowKeyAdjustment(event)">
            </div>
        </div>
        <hr>
        <div class="header-section">
            <div class="header-group">
                <label for="DOC_MARKS_DESC">標記及貨櫃號碼</label>
                <textarea id="DOC_MARKS_DESC" name="DOC_MARKS_DESC" rows="5"></textarea>
            </div>
            <div class="header-group">
                <label for="DOC_OTR_DESC">其它申報事項</label>
                <textarea id="DOC_OTR_DESC" name="DOC_OTR_DESC" rows="5"></textarea>
            </div>
            <select id="doc_otr_desc_dropdown" class="custom-select" style="width: 180px;"> <!-- 調整這裡的寬度 -->
                <option value="">備註選單</option>
                <option value="國貨樣品/贈送不再進口">【統計方式04】國貨樣品/贈送不再進口</option>
                <option value="委外加工不再進口">【統計方式05】委外加工不再進口</option>
                <option value="在出口之翌日起一年內或於財政部核定之日期前原貨復運進口">【統計方式53】在出口之翌日起一年內或於財政部核定之日期前原貨復運進口</option>
                <option value="本批貨物為國貨修理後復出口">【統計方式91】本批貨物為國貨修理後復出口</option>
                <option value="洋貨復出口，復出口原因：退回修理，修理完畢後會再復運進口">【統計方式9M】洋貨復出口，復出口原因：退回修理，修理完畢後會再復運進口</option>
                <option value="申請沖退原料稅(E化退稅)">申請沖退原料稅(E化退稅)</option>
                <option value="申請報單副本第三聯(沖退原料稅用聯)
附外銷品使用原料及其供應商資料清表">申請報單副本第三聯(沖退原料稅用聯)，附外銷品使用原料及其供應商資料清表</option>
                <option value="申請報單副本第四聯(退內地稅用聯)
稅照號碼：">申請報單副本第四聯(退內地稅用聯)，稅照號碼：</option>
                <option value="申請報單副本第五聯(出口證明用聯)">申請報單副本第五聯(出口證明用聯)</option>
                <option value="洋貨轉售，附原進口報單">洋貨轉售，附原進口報單</option>
                <option value="洋貨轉售
因無法提供原進口報單號碼，特附國內購買憑證以茲證明">洋貨轉售，因無法提供原進口報單號碼，特附國內購買憑證以茲證明</option>
                <option value="洋貨轉售
因無法取得原進口報單及購買憑證，願繳納推廣貿易服務費">洋貨轉售，因無法取得原進口報單及購買憑證，願繳納推廣貿易服務費</option>
                <option value="洋貨復出口不再進口(贈送/樣品/不良品退回)，附原進口報單">洋貨復出口不再進口(贈送/樣品/不良品退回)，附原進口報單</option>
                <option value="洋貨復出口不再進口(贈送/樣品/不良品退回)
因無法提供原進口報單號碼，特附國內購買憑證以茲證明">洋貨復出口不再進口(贈送/樣品/不良品退回)，因無法提供原進口報單號碼，特附國內購買憑證以茲證明</option>
                <option value="洋貨復出口不再進口(贈送/樣品/不良品退回)
因無法取得原進口報單及購買憑證，願繳納推廣貿易服務費">洋貨復出口不再進口(贈送/樣品/不良品退回)，因無法取得原進口報單及購買憑證，願繳納推廣貿易服務費</option>
            </select>
            <hr>
            <div class="header-group">
                <label for="REMARK1">REMARKS</label>
                <textarea id="REMARK1" name="REMARK1" rows="5"></textarea>
            </div>
        </div>
        <p style="margin-bottom: 20px;"></p>
    </div>

    <!--報單項次-->
    <div id="items" class="tab">
        <div id="header-container">
            <div class="add-buttons">
                <button onclick="openItemModal()">新增項次(可複製)</button>
                <button onclick="openSpecifyFieldModal()">指定填列欄位資料</button>
                <button onclick="openAdjustOrderModal()">調整項次順序</button>
                <button onclick="openToggleFieldsModal()">顯示隱藏欄位</button>
                <button id="toggle-all-btn" onclick="toggleAllTextareas()">展開全部品名</button>
                ｜
                <button id="calculate-quantities-btn" onclick="calculateQuantities()">數量核算</button>
                <button id="calculate-amounts-btn" onclick="calculateAmounts()">金額核算</button>
                <input type="number" id="decimal-places" placeholder="預設2位" min="0" max="6" style="width: 60px;">
                ｜
                <button id="calculate-weight-btn" onclick="calculateWeight()">重量核算</button>
                <button id="spread-weight-btn" onclick="spreadWeight()">攤重</button>
                <input type="number" id="decimal-places-weight" placeholder="預設2位" min="0" max="6" style="width: 60px;">
            </div>
            <div class="add-buttons">
                <input type="checkbox" id="toggle-fix-top" onclick="toggleFixTop()"> 固定欄位標題
                <input type="checkbox" id="toggle-width" onclick="toggleWidth()"> 固定頁面寬度
            </div>
            <div class="item-row item-header">
                <div class="form-group fix item-no item-no-header" onclick="toggleAllItems()">
                    <label>NO</label>
                </div>
                <div class="form-group fix">
                    <label>大品名註記</label>
                </div>
                <div class="form-group fix item-number" style="width: 2%;">
                    <label>項次</label>
                </div>
                <div class="form-group DESCRIPTION" style="width: 200%;">
                    <label>品名</label>
                </div>
                <div class="form-group QTY" style="width: 60%;">
                    <label>數量</label>
                </div>
                <div class="form-group DOC_UM" style="width: 40%;">
                    <label>單位</label>
                </div>
                <div class="form-group DOC_UNIT_P" style="width: 60%;">
                    <label>單價</label>
                </div>
                <div class="form-group DOC_TOT_P" style="width: 80%;">
                    <label>金額</label>
                </div>
                <div class="form-group TRADE_MARK" style="width: 80%;">
                    <label>商標</label>
                </div>
                <div class="form-group CCC_CODE" style="width: 100%;">
                    <label>稅則</label>
                </div>
                <div class="form-group ST_MTD" style="width: 30%;">
                    <label>統計方式</label>
                </div>
                <div class="form-group ISCALC_WT" style="width: 20%;">
                    <label>鎖定</label>
                </div>
                <div class="form-group NET_WT" style="width: 60%;">
                    <label>淨重</label>
                </div>
                <div class="form-group ORG_COUNTRY hidden" style="width: 30%;">
                    <label>生產國別</label>
                </div>
                <div class="form-group ORG_IMP_DCL_NO hidden">
                    <label>原進口報單號碼</label>
                </div>
                <div class="form-group ORG_IMP_DCL_NO_ITEM hidden" style="width: 30%;">
                    <label>原進口報單項次</label>
                </div>
                <div class="form-group SELLER_ITEM_CODE hidden">
                    <label>賣方料號</label>
                </div>
                <div class="form-group BOND_NOTE hidden" style="width: 30%;">
                    <label>保稅貨物註記</label>
                </div>
                <div class="form-group GOODS_MODEL hidden" style="width: 60%;">
                    <label>型號</label>
                </div>
                <div class="form-group GOODS_SPEC hidden" style="width: 60%;">
                    <label>規格</label>
                </div>
                <div class="form-group CERT_NO hidden">
                    <label>產證號碼</label>
                </div>
                <div class="form-group CERT_NO_ITEM hidden" style="width: 30%;">
                    <label>產證項次</label>
                </div>
                <div class="form-group ORG_DCL_NO hidden">
                    <label>原進倉報單號碼</label>
                </div>
                <div class="form-group ORG_DCL_NO_ITEM hidden" style="width: 30%;">
                    <label>原進倉報單項次</label>
                </div>
                <div class="form-group EXP_NO hidden">
                    <label>輸出許可號碼</label>
                </div>
                <div class="form-group EXP_SEQ_NO hidden" style="width: 30%;">
                    <label>輸出許可項次</label>
                </div>
                <div class="form-group WIDE hidden" style="width: 60%;">
                    <label>寬度(幅寬)</label>
                </div>
                <div class="form-group WIDE_UM hidden"  style="width: 40%;">
                    <label>寬度單位</label>
                </div>
                <div class="form-group LENGT_ hidden" style="width: 60%;">
                    <label>長度(幅長)</label>
                </div>
                <div class="form-group LENGTH_UM hidden" style="width: 40%;">
                    <label>長度單位</label>
                </div>     
                <div class="form-group ST_QTY hidden" style="width: 60%;">
                    <label>統計數量</label>
                </div>  
                <div class="form-group ST_UM hidden" style="width: 40%;">
                    <label>統計單位</label>
                </div>         
                <div class="form-group fix">
                    <label>刪除</label>
                </div>
            </div>
        </div>
        <p style="margin-top: 10px;"></p>        
        <div id="item-container"></div>
    </div>

    <!-- 新增項次彈跳框 -->
    <div id="item-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header" id="item-modal-header">
                <h2>新增項次(可複製)</h2>
            </div>
            <div class="flex-group">
                <input type="checkbox" id="ITEM_NO" name="HAS_MAJOR_NAME" onchange="toggleMajorName(event)">
                <label for="ITEM_NO">大品名註記(勾選大品名註記時，只需填寫品名)</label>
            </div>
            <div class="header-group">
                <label for="COPY_ITEM">選擇要複製的項次</label>
                <select id="COPY_ITEM">
                    <option value="">選擇項次</option>
                </select>
            </div>
            <div class="header-group">
                <label for="DESCRIPTION">品名</label>
                <textarea id="DESCRIPTION" class="DESCRIPTION" rows="5"></textarea>
            </div>
            <div class="header-group">
                <label for="QTY">數量</label>
                <input type="number" id="QTY" class="QTY" min="0" oninput="calculateAmount(event)">
            </div>
            <div class="header-group">
                <label for="DOC_UM">單位</label>
                <input type="text" id="DOC_UM" class="DOC_UM"
                    placeholder="範例：EAC、PCE、SET、YRD、MTR(英文代碼)">
            </div>
            <div class="header-group">
                <label for="DOC_UNIT_P">單價</label>
                <input type="number" id="DOC_UNIT_P" class="DOC_UNIT_P" min="0" oninput="calculateAmount(event)">
            </div>
            <div class="header-group">
                <label for="DOC_TOT_P">金額</label>
                <input type="number" id="DOC_TOT_P" class="DOC_TOT_P" min="0" readonly>
            </div>
            <div class="header-group">
                <label for="TRADE_MARK">商標</label>
                <input type="text" id="TRADE_MARK" class="TRADE_MARK" name="TRADE_MARK" list="trademark-list"
                    placeholder="範例：NO BRAND(無商標)、FIG(圖樣)、文字(字樣)">
                <datalist id="trademark-list">
                    <option value="NO BRAND">無商標</option>
                    <option value="FIG">圖樣</option>
                </datalist>
            </div>
            <div class="header-group">
                <label for="CCC_CODE">稅則</label>
                <input type="text" id="CCC_CODE" class="CCC_CODE" 
                    placeholder="可輸入關鍵字按Enter查詢後選取(台灣稅則－共11碼，前6碼國際通用)" onkeydown="handleCCCCodeEnter(event, this)">
            </div>
            <div class="header-group">
                <label for="ST_MTD">統計方式</label>
                <input type="text" id="ST_MTD" class="ST_MTD" name="ST_MTD" list="method-list">
                <datalist id="method-list">
                    <option value="02">國貨銷售</option>
                    <option value="04">國貨樣品/贈送</option>
                    <option value="81">洋貨銷售</option>
                    <option value="82">洋貨樣品/贈送/不良品退回</option>
                </datalist>
            </div>
            <div class="header-group">
                <label for="NET_WT">淨重</label>
                <input type="number" id="NET_WT" class="NET_WT" min="0">
            </div>            
            <hr>
            <div class="header-group">洋貨復出口核銷欄位</div>
            <div class="header-group">
                <label for="ORG_COUNTRY">生產國別</label>
                <input type="text" id="ORG_COUNTRY" class="ORG_COUNTRY"
                placeholder="範例：US、CN、JP、GB(英文代碼)">
            </div>
            <div class="header-group">
                <label for="ORG_IMP_DCL_NO">原進口報單號碼</label>
                <input type="text" id="ORG_IMP_DCL_NO" class="ORG_IMP_DCL_NO"
                placeholder="範例：CX  13709IPORT(中間為兩位空格) 或 CXDA13709IPORT(共14碼)">
            </div>
            <div class="header-group">
                <label for="ORG_IMP_DCL_NO_ITEM">原進口報單項次</label>
                <input type="number" id="ORG_IMP_DCL_NO_ITEM" class="ORG_IMP_DCL_NO_ITEM">
            </div>
            <hr>
            <div class="header-group">保稅貨物欄位</div>
            <div class="header-group">
                <label for="SELLER_ITEM_CODE">賣方料號</label>
                <input type="text" id="SELLER_ITEM_CODE" class="SELLER_ITEM_CODE">
            </div>
            <div class="header-group">
                <label for="BOND_NOTE">保稅貨物註記</label>
                <input type="text" id="BOND_NOTE" class="BOND_NOTE"
                placeholder="範例：YB(保品)、NB(非保品)">
            </div>            
            <hr>
            <div class="header-group">ECFA產證欄位</div>
            <div class="header-group">
                <label for="GOODS_MODEL">型號</label>
                <input type="text" id="GOODS_MODEL" class="GOODS_MODEL">
            </div>
            <div class="header-group">
                <label for="GOODS_SPEC">規格</label>
                <input type="text" id="GOODS_SPEC" class="GOODS_SPEC">
            </div>
            <div class="header-group">
                <label for="CERT_NO">產證號碼</label>
                <input type="text" id="CERT_NO" class="CERT_NO"
                    placeholder="範例：DN24CE00072(共11碼)">
            </div>
            <div class="header-group">
                <label for="CERT_NO_ITEM">產證項次</label>
                <input type="number" id="CERT_NO_ITEM" class="CERT_NO_ITEM">
            </div>
            <hr>
            <div class="header-group">D5保稅倉核銷欄位</div>
            <div class="header-group">
                <label for="ORG_DCL_NO">原進倉報單號碼</label>
                <input type="text" id="ORG_DCL_NO" class="ORG_DCL_NO">
            </div>
            <div class="header-group">
                <label for="ORG_DCL_NO_ITEM">原進倉報單項次</label>
                <input type="number" id="ORG_DCL_NO_ITEM" class="ORG_DCL_NO_ITEM">
            </div>
            <hr>
            <div class="header-group">管制品欄位</div>
            <div class="header-group">
                <label for="EXP_NO">輸出許可號碼</label>
                <input type="text" id="EXP_NO" class="EXP_NO"
                    placeholder="範例：FTSI11W0000079(共14碼)">
            </div>
            <div class="header-group">
                <label for="EXP_SEQ_NO">輸出許可項次</label>
                <input type="number" id="EXP_SEQ_NO" class="EXP_SEQ_NO">
            </div>
            <hr>
            <div class="header-group">布貨品欄位</div>
            <div class="header-group">
                <label for="WIDE">寬度(幅寬)</label>
                <input type="number" id="WIDE" class="WIDE">
            </div>
            <div class="header-group">
                <label for="WIDE_UM">寬度單位</label>
                <input type="text" id="WIDE_UM" class="WIDE_UM">
            </div>
            <div class="header-group">
                <label for="LENGT_">長度(幅長)</label>
                <input type="number" id="LENGT_" class="LENGT_">
            </div>
            <div class="header-group">
                <label for="LENGTH_UM">長度單位</label>
                <input type="text" id="LENGTH_UM" class="LENGTH_UM">
            </div> 
            <hr>
            <div class="header-group">與數量單位不同另外填列</div>
            <div class="header-group">
                <label for="ST_QTY">統計數量</label>
                <input type="number" id="ST_QTY" class="ST_QTY">
            </div>
            <div class="header-group">
                <label for="ST_UM">統計單位</label>
                <input type="text" id="ST_UM" class="ST_UM">
            </div>           
            <div class="floating-buttons">
                <button id="rememberButton" onclick="rememberItemModalData()">記憶</button>
                <button onclick="saveItem()">儲存</button>
                <button onclick="closeItemModal()">取消</button>
            </div>
        </div>
    </div>

    <!-- 稅則查詢彈跳框 -->
    <div id="taxmodal" class="taxmodal">
        <div class="taxmodal-content">
            <span class="close">&times;</span>
            <div id="modal-results"></div>
        </div>
    </div>

    <!-- 調整順序彈跳框 -->
    <div id="adjust-order-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header" id="adjust-order-modal-header">
                <h2>調整順序</h2>
            </div>
            <h4>【直接拖曳調整項次的排列順序】</h4>
            <div id="order-list" class="order-list">
                <!-- 動態生成的項次列表 -->
            </div>
            <div class="floating-buttons">
                <button onclick="saveNewOrder()">儲存</button>
                <button onclick="closeOrderModal()">取消</button>
            </div>
        </div>
    </div>

    <!-- 指定填列欄位資料的彈跳框 -->
    <div id="specify-field-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header" id="specify-field-modal-header">
                <h2>指定填列欄位資料</h2>
            </div>
            <div class="header-group">
                <label for="specify-mode">模式</label>
                <select id="specify-mode" onchange="toggleSpecifyMode()">
                    <option value="custom">自定義填列內容</option>
                    <option value="copy">從源項次複製內容</option>
                </select>
            </div>
            <div id="custom-content" class="specify-mode-content">
                <div class="header-group">
                    <label for="specify-item-numbers">NO(例如: 3,5-7)</label>
                    <input type="text" id="specify-item-numbers">
                </div>
                <div class="header-group">
                    <label for="specify-field-name">欄位名稱</label>
                    <select id="specify-field-name">
                        <option value="DESCRIPTION">品名</option>
                        <option value="QTY">數量</option>
                        <option value="DOC_UM">單位</option>
                        <option value="DOC_UNIT_P">單價</option>
                        <option value="DOC_TOT_P">金額</option>
                        <option value="TRADE_MARK">商標</option>
                        <option value="CCC_CODE">稅則</option>
                        <option value="ST_MTD">統計方式</option>
                        <option value="NET_WT">淨重</option>                        
                        <option class="separator" disabled>──────────</option>
                        <option value="ORG_COUNTRY">生產國別</option>
                        <option value="ORG_IMP_DCL_NO">原進口報單號碼</option>
                        <option value="ORG_IMP_DCL_NO_ITEM">原進口報單項次</option>
                        <option class="separator" disabled>──────────</option>
                        <option value="SELLER_ITEM_CODE">賣方料號</option>
                        <option value="BOND_NOTE">保稅貨物註記</option>
                        <option class="separator" disabled>──────────</option>
                        <option value="GOODS_MODEL">型號</option>
                        <option value="GOODS_SPEC">規格</option>
                        <option value="CERT_NO">產證號碼</option>
                        <option value="CERT_NO_ITEM">產證項次</option>
                        <option class="separator" disabled>──────────</option>
                        <option value="ORG_DCL_NO">原進倉報單號碼</option>
                        <option value="ORG_DCL_NO_ITEM">原進倉報單項次</option>
                        <option class="separator" disabled>──────────</option>
                        <option value="EXP_NO">輸出許可號碼</option>
                        <option value="EXP_SEQ_NO">輸出許可項次</option>
                        <option class="separator" disabled>──────────</option>
                        <option value="WIDE">寬度(幅寬)</option>
                        <option value="WIDE_UM">寬度單位</option>
                        <option value="LENGT_">長度(幅長)</option>
                        <option value="LENGTH_UM">長度單位</option>
                        <option class="separator" disabled>──────────</option>
                        <option value="ST_QTY">統計數量</option>
                        <option value="ST_UM">統計單位</option>
                    </select>
                </div>
                <!-- 新增起始編號輸入框，只在選擇產證序號時顯示 -->
                <div id="start-number-container" style="display: none;">
                    <label for="start-number">起始編號:</label>
                    <input type="number" id="start-number" value="1" min="1" class="small-input">
                </div>

                <div class="header-group">
                    <label for="specify-field-value">填列內容</label>
                    <textarea id="specify-field-value" rows="3"></textarea>
                </div>
            </div>
            <div id="copy-content" class="specify-mode-content" style="display:none;">
                <div class="header-group">
                    <label for="source-item-number">源項次</label>
                    <select id="source-item-number">
                        <option value="">選擇項次</option>
                    </select>
                </div>
                <div class="header-group">
                    <label for="specify-field-names-copy">欄位名稱(可複選)</label>
                    <select id="specify-field-names-copy" multiple style="height: 300px;">
                        <option value="DESCRIPTION">品名</option>
                        <option value="QTY">數量</option>
                        <option value="DOC_UM">單位</option>
                        <option value="DOC_UNIT_P">單價</option>
                        <option value="DOC_TOT_P">金額</option>
                        <option value="TRADE_MARK">商標</option>
                        <option value="CCC_CODE">稅則</option>
                        <option value="ST_MTD">統計方式</option>
                        <option value="NET_WT">淨重</option>
                        <option class="separator" disabled>──────────</option>
                        <option value="ORG_COUNTRY">生產國別</option>
                        <option value="ORG_IMP_DCL_NO">原進口報單號碼</option>
                        <option value="ORG_IMP_DCL_NO_ITEM">原進口報單項次</option>
                        <option class="separator" disabled>──────────</option>
                        <option value="SELLER_ITEM_CODE">賣方料號</option>
                        <option value="BOND_NOTE">保稅貨物註記</option>
                        <option class="separator" disabled>──────────</option>
                        <option value="GOODS_MODEL">型號</option>
                        <option value="GOODS_SPEC">規格</option>
                        <option value="CERT_NO">產證號碼</option>
                        <option value="CERT_NO_ITEM">產證項次</option>
                        <option class="separator" disabled>──────────</option>
                        <option value="ORG_DCL_NO">原進倉報單號碼</option>
                        <option value="ORG_DCL_NO_ITEM">原進倉報單項次</option>
                        <option class="separator" disabled>──────────</option>
                        <option value="EXP_NO">輸出許可號碼</option>
                        <option value="EXP_SEQ_NO">輸出許可項次</option> 
                        <option class="separator" disabled>──────────</option>
                        <option value="WIDE">寬度(幅寬)</option>
                        <option value="WIDE_UM">寬度單位</option>
                        <option value="LENGT_">長度(幅長)</option>
                        <option value="LENGTH_UM">長度單位</option>
                        <option class="separator" disabled>──────────</option>
                        <option value="ST_QTY">統計數量</option>
                        <option value="ST_UM">統計單位</option>
                    </select>
                </div>
                <div class="header-group">
                    <label for="target-item-numbers">目標NO(例如: 1,7-8)</label>
                    <input type="text" id="target-item-numbers">
                </div>
            </div>
            <div class="header-group">
                <label for="overwrite-option">覆蓋選項</label>
                <select id="overwrite-option">
                    <option value="all">全部覆蓋</option>
                    <option value="empty">覆蓋未填列之項次</option>
                    <option value="specified">覆蓋已填列之項次</option>
                </select>
            </div>
            <div class="floating-buttons">
                <button onclick="applyFieldData()">儲存</button>
                <button onclick="closeSpecifyFieldModal()">取消</button>
            </div>
        </div>
    </div>

    <!-- 顯示隱藏欄位彈跳框 -->
    <div id="toggle-fields-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>顯示/隱藏欄位</h2>
            </div>
            <div class="header-group">
                <label for="field-select">選擇欄位(可複選)</label>
                <select id="field-select" multiple style="height: 300px;">
                    <option>必填欄位</option>
                    <option class="separator" disabled>──────────</option>
                    <option value="ORG_COUNTRY">生產國別</option>
                    <option value="ORG_IMP_DCL_NO">原進口報單號碼</option>
                    <option value="ORG_IMP_DCL_NO_ITEM">原進口報單項次</option>
                    <option class="separator" disabled>──────────</option>
                    <option value="SELLER_ITEM_CODE">賣方料號</option>
                    <option value="BOND_NOTE">保稅貨物註記</option>
                    <option class="separator" disabled>──────────</option>
                    <option value="GOODS_MODEL">型號</option>
                    <option value="GOODS_SPEC">規格</option>
                    <option value="CERT_NO">產證號碼</option>
                    <option value="CERT_NO_ITEM">產證項次</option>
                    <option class="separator" disabled>──────────</option>
                    <option value="ORG_DCL_NO">原進倉報單號碼</option>
                    <option value="ORG_DCL_NO_ITEM">原進倉報單項次</option>
                    <option class="separator" disabled>──────────</option>
                    <option value="EXP_NO">輸出許可號碼</option>
                    <option value="EXP_SEQ_NO">輸出許可項次</option>
                    <option class="separator" disabled>──────────</option>
                    <option value="WIDE">寬度(幅寬)</option>
                    <option value="WIDE_UM">寬度單位</option>
                    <option value="LENGT_">長度(幅長)</option>
                    <option value="LENGTH_UM">長度單位</option>
                    <option class="separator" disabled>──────────</option>
                    <option value="ST_QTY">統計數量</option>
                    <option value="ST_UM">統計單位</option>
                </select>
            </div>
            <div class="floating-buttons">
                <button onclick="applyToggleFields()">套用</button>
                <button onclick="closeToggleFieldsModal()">取消</button>
            </div>
        </div>
    </div>
    
    <!--報單副本-->
    <div id="copy" class="tab">
        <div class="header-section">
            <div class="flex-group">
                <input type="checkbox" id="copy_3_e" name="copy_option">申請沖退原料稅(E化退稅)<br>
            </div>
            <div class="flex-group">
                <input type="checkbox" id="copy_3" name="copy_option">申請報單副本第三聯(沖退原料稅用聯)<br>
            </div>
            <div class="flex-group">
                <input type="checkbox" id="copy_4" name="copy_option">申請報單副本第四聯(退內地稅用聯)<br>
            </div>
            <div class="flex-group">
                <input type="checkbox" id="copy_5" name="copy_option">申請報單副本第五聯(出口證明用聯)<br>
            </div>  
        </div>
        <input type="hidden" id="APP_DUTY_REFUND" value="">
        <input type="hidden" id="MARK_TOT_LINES" value="">
        <input type="hidden" id="EXAM_TYPE" value="">
        <input type="hidden" id="COPY_QTY" value="">
        <h4 style="color: rgba(255, 0, 0, 0.634);">【提醒！】如果需申請沖退原料稅或報單副本，請務必記得勾選，<br>
            系統會將其它需要填列的欄位自動進行設定，自動設定的欄位有：<br>
            申請審驗方式、報單副本份數、申請沖退原料稅、檢附外銷品使用原料及其供應商資料表。
        </h4>
    </div>
    
    <!-- 用於顯示變數值 -->
    <div id="variables" style="display:none;">
        <input type="hidden" id="APP_DUTY_REFUND" value="N">
        <input type="hidden" id="MARK_TOT_LINES" value="N">
        <input type="hidden" id="EXAM_TYPE" value="">
        <input type="hidden" id="COPY_QTY" value="0">
    </div>

    <!--保稅貨物-->
    <div id="bonded" class="tab">
        <div class="header-section">
            <div class="header-group">
                <label for="FAC_BAN_ID_EX">保稅廠統一編號</label>
                <input type="text" id="FAC_BAN_ID_EX" name="FAC_BAN_ID_EX">
            </div>
            <div class="header-group">
                <label for="FAC_BONDED_ID_EX">保稅廠監管編號</label>
                <input type="text" id="FAC_BONDED_ID_EX" name="FAC_BONDED_ID_EX">
            </div>
            <hr>
            <div class="header-group">
                <label for="FAC_BAN_ID">出倉保稅倉庫統一編號</label>
                <input type="text" id="FAC_BAN_ID" name="FAC_BAN_ID">
            </div>
            <div class="header-group">
                <label for="FAC_BONDED_ID">出倉保稅倉庫代碼</label>
                <input type="text" id="FAC_BONDED_ID" name="FAC_BONDED_ID">
            </div>
            <hr>
            <div class="header-group">
                <label for="IN_BONDED_BAN">進倉保稅倉庫統一編號</label>
                <input type="text" id="IN_BONDED_BAN" name="IN_BONDED_BAN">
            </div>
            <div class="header-group">
                <label for="IN_BONDED_CODE">進倉保稅倉庫代碼</label>
                <input type="text" id="IN_BONDED_CODE" name="IN_BONDED_CODE">
            </div>
        </div>
        <h4 style="color: #005feec5;">【註】此頁適用於以下出貨型態：<br>
            1. 出口人本身不是保稅廠，但由另外合作的供應商（保稅廠）負責出貨<br>
            2. 報單類別為 D5 保稅倉貨物出口<br>
            3. 報單類別為 F5 自由港區貨物出口
        </h4>
    </div>

    <div class="import-export-buttons">
        <input type="file" id="import-excel" accept=".xlsx, .xls" style="display:none;">
        <button class="excel-btn" onclick="document.getElementById('import-excel').click();">匯入Excel</button>
        <button class="excel-btn" id="export-excel">匯出Excel</button>
        <div>｜</div>
        <input type="file" id="import-xml" accept=".xml" style="display:none;">
        <button class="xml-btn" onclick="document.getElementById('import-xml').click();">匯入XML</button>
        <button class="xml-btn" id="export-to-xml">匯出XML</button>
        <div>｜</div>
        <button id="export-to-pdf">出口報單預覽</button>
    </div>
    <!-- 提示訊息 -->
    <div id="loadingMessage" style="display:none; position:fixed; top:50%; left:50%; transform:translate(-50%, -50%); padding:20px; background-color:#f8f8f8; border:1px solid #ccc; z-index:1000;">
        生成PDF需等候，請勿重複點選
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.0/xlsx.full.min.js"></script>    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.13/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.10.377/pdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jsbarcode/3.11.5/JsBarcode.all.min.js"></script>
    <script src="https://unpkg.com/pdf-lib/dist/pdf-lib.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/izitoast/1.4.0/css/iziToast.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/izitoast/1.4.0/js/iziToast.min.js"></script>
    <script src="script.js"></script>
    
</body>
</html>
